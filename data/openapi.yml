openapi: 3.1.0

info:
  title: "%PROJECT_NAME%"
  description: "%PROJECT_DESCRIPTION%"
  version: "%PROJECT_VERSION%"

servers:
  - url: "http://%ADDRESS%"

tags:
  - name: Metadata
    description: Des requêtes qui permettent de récupérer des informations autour du serveur web (et non pas d'effectuer des actions !)

paths:
  /v1/metadata:
    get:
      tags:
        - Metadata
      summary: "Récupère les métadonnées de l'ESP32."
      description: "Récupère des métadonnées (notamment uptime) de l'ESP32."
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Metadata"
  /v1/sensors/photocell:
    get:
      tags:
        - Sensors
      summary: "Récupère la valeur actuelle pour le sensor photocell"
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenericSensor"


  /v1/mechanical/buzzer/activate:
    post:
      tags:
        - Mechanical
      summary: "Active le buzzer après un délai et pendant une durée spécifiée."
      description: "Envoie une requête pour activer le buzzer après un délai (`delay`) et pendant une durée spécifiée (`duration`)."
      parameters:
        - name: delay
          in: query
          required: true
          description: "Délai avant d'activer le buzzer (en millisecondes)."
          schema:
            type: integer
        - name: duration
          in: query
          required: true
          description: "Durée pendant laquelle le buzzer sonne (en millisecondes)."
          schema:
            type: integer
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ActivateBuzzerResponse"
        '400':
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /v1/mechanical/buzzer/stop:
    post:
      tags:
        - Mechanical
      summary: "Arrête le buzzer immédiatement."
      description: "Envoie une requête pour arrêter le buzzer si ce dernier est en train de sonner."
      responses:
        '200':
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StopBuzzerResponse"

components:
  schemas:
    Metadata:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        version:
          type: string
        uptime:
          type: integer
    GenericSensor:
      type: object
      properties:
        name:
          type: string
        value:
          type: integer
     ActivateBuzzerResponse:
      type: object
      properties:
        message:
          type: string
        delay:
          type: integer
        duration:
          type: integer
    StopBuzzerResponse:
      type: object
      properties:
        message:
          type: string
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
